require "rails_helper"

RSpec.describe Moderation::Detectors::HealingExploit do
  it "creates a ticket when delta exceeds threshold" do
    character = create(:character)
    reporter = create(:user, :moderator)

    ticket = described_class.new.call(
      character:,
      reporter:,
      delta_seconds: (Moderation::Detectors::HealingExploit::MAX_ALLOWED_SHIFT + 60).to_i
    )

    expect(ticket).to be_present
    expect(ticket.category).to eq("exploit")
  end

  it "ignores small adjustments" do
    character = create(:character)
    reporter = create(:user, :moderator)

    result = described_class.new.call(
      character:,
      reporter:,
      delta_seconds: 60
    )

    expect(result).to be_nil
  end
end
