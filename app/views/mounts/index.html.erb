<section class="mounts-dashboard">
  <div class="page-header">
    <h1>Mounts & Stable</h1>
    <p>Summon mounts for overworld travel speed bonuses and cosmetics.</p>
  </div>

  <div class="grid md:grid-cols-2 gap-4">
    <% @mounts.each do |mount| %>
      <article class="mount-card" data-mobile-hud-target="panel" id="<%= dom_id(mount) %>">
        <header class="flex justify-between">
          <div>
            <h2><%= mount.name %></h2>
            <p class="text-muted text-sm">
              <%= mount.mount_type.titleize %> •
              <span class="badge"><%= mount.faction_key.titleize %></span> •
              <span class="badge badge--<%= mount.rarity %>"><%= mount.rarity.titleize %></span>
            </p>
          </div>
          <span class="mount-speed">+<%= mount.speed_bonus %>% speed</span>
        </header>
        <p class="text-xs text-muted mt-2">State: <span class="badge"><%= mount.summon_state.titleize %></span></p>
        <div class="flex gap-2 mt-3">
          <%= form_with url: assign_to_slot_mount_path(mount), method: :post, scope: :slot do |form| %>
            <%= form.number_field :slot_index, min: 0, placeholder: "Slot #", class: "w-16" %>
            <%= form.submit "Assign Slot", class: "btn-secondary btn-sm" %>
          <% end %>
          <%= form_with url: summon_mount_path(mount), method: :post, scope: :slot do |form| %>
            <%= form.hidden_field :slot_index, value: mount.mount_stable_slot&.slot_index %>
            <%= form.submit "Summon", class: "btn-primary btn-sm", disabled: mount.mount_stable_slot.nil? %>
          <% end %>
        </div>
      </article>
    <% end %>
  </div>

  <section class="card mt-4 border-t pt-4">
    <h2>Stable Slots</h2>
    <div class="flex flex-wrap gap-3">
      <% @stable_slots.each do |slot| %>
        <div class="card" style="width: 12rem;">
          <p class="font-semibold text-sm">Slot <%= slot.slot_index %></p>
          <p class="text-xs text-muted">Status: <span class="badge"><%= slot.status.titleize %></span></p>
          <% if slot.current_mount %>
            <p class="text-xs text-muted mt-1">Mount: <%= slot.current_mount.name %></p>
          <% end %>
        </div>
      <% end %>
    </div>
    <%= form_with url: unlock_slot_mounts_path, method: :post, scope: :slot, class: "mt-3 flex gap-2" do |form| %>
      <%= form.number_field :slot_index, min: 0, placeholder: "Slot # to unlock", class: "w-32" %>
      <%= form.submit "Unlock Slot", class: "btn-secondary" %>
    <% end %>
  </section>

  <section class="card mt-4 border-t pt-4">
    <h2>Register New Mount</h2>
    <%= form_with model: Mount.new, url: mounts_path, class: "grid md:grid-cols-3 gap-3" do |form| %>
      <div class="field">
        <%= form.label :name %>
        <%= form.text_field :name, required: true %>
      </div>
      <div class="field">
        <%= form.label :mount_type %>
        <%= form.text_field :mount_type, required: true %>
      </div>
      <div class="field">
        <%= form.label :speed_bonus %>
        <%= form.number_field :speed_bonus, value: 0 %>
      </div>
      <div class="field">
        <%= form.label :faction_key %>
        <%= form.text_field :faction_key, value: "neutral" %>
      </div>
      <div class="field">
        <%= form.label :rarity %>
        <%= form.text_field :rarity, value: "common" %>
      </div>
      <div class="field">
        <%= form.label :cosmetic_variant %>
        <%= form.text_field :cosmetic_variant, value: "default" %>
      </div>
      <div class="field md:col-span-3 text-right">
        <%= form.submit "Register Mount", class: "btn-primary" %>
      </div>
    <% end %>
  </section>
</section>
