<%= form_with model: [chat_channel, chat_message],
              class: "chat-form",
              data: {
                turbo_frame: "_top",
                action: "turbo:submit-end->chat#resetForm"
              } do |form| %>

  <% if chat_message.errors.any? %>
    <div class="chat-form-errors flash error">
      <%= chat_message.errors.full_messages.to_sentence %>
    </div>
  <% end %>

  <div class="chat-input-wrapper">
    <%= form.text_field :body,
        class: "chat-input",
        placeholder: "Type a message... (Enter to send, /w name to whisper)",
        autocomplete: "off",
        data: {
          chat_target: "input",
          action: "keydown->chat#handleKeydown input->chat#handleInput"
        } %>

    <div class="emoji-picker-container" style="position: relative;">
      <button type="button" class="emoji-toggle-btn" data-action="click->chat#toggleEmojiPicker" title="Add emoji">ðŸ˜Š</button>
      <div class="emoji-picker">
        <% %w[ðŸ˜€ ðŸ˜‚ ðŸ˜Š ðŸ˜ ðŸ¤” ðŸ˜… ðŸ˜Ž ðŸ™„ ðŸ˜¢ ðŸ˜¡ ðŸ‘ ðŸ‘Ž â¤ï¸ ðŸ”¥ âš”ï¸ ðŸ›¡ï¸ ðŸ—¡ï¸ ðŸ’° â­ ðŸ† ðŸŽ® ðŸ’€ ðŸ‘» ðŸ§™ ðŸ§ ðŸ‰ ðŸ° âš¡ ðŸ’Ž ðŸº].each do |emoji| %>
          <button type="button" class="emoji-btn" data-action="click->chat#insertEmoji" data-emoji="<%= emoji %>"><%= emoji %></button>
        <% end %>
      </div>
    </div>

    <%= form.submit "Send", class: "btn-primary chat-send-btn" %>
  </div>

  <p class="chat-guidelines text-xs text-muted">
    Be respectful. <span class="chat-guideline-link" data-controller="moderation-guideline"
    data-action="mouseenter->moderation-guideline#show mouseleave->moderation-guideline#hide"
    data-guideline="chat_abuse">View guidelines</span>
  </p>
<% end %>
