<%# Arena match participant with HP/MP bars - supports both characters and NPCs %>
<% character = participation.character %>
<% npc_template = participation.npc_template %>
<% is_npc = npc_template.present? %>

<%# Get participant stats - from character or NPC template %>
<% if is_npc %>
  <% current_hp = participation.metadata&.dig("current_hp") || npc_template.health %>
  <% max_hp = participation.metadata&.dig("max_hp") || npc_template.health %>
  <% current_mp = 0 %>
  <% max_mp = 0 %>
  <% participant_name = npc_template.name %>
  <% participant_level = npc_template.level %>
  <% participant_id = "npc-#{npc_template.id}" %>
<% else %>
  <% current_hp = character.current_hp %>
  <% max_hp = character.max_hp %>
  <% current_mp = character.current_mp %>
  <% max_mp = character.max_mp %>
  <% participant_name = character.name %>
  <% participant_level = character.level %>
  <% participant_id = character.id %>
<% end %>

<% hp_percent = max_hp.zero? ? 0 : ((current_hp.to_f / max_hp) * 100).round(1) %>
<% mp_percent = max_mp.zero? ? 0 : ((current_mp.to_f / max_mp) * 100).round(1) %>

<div class="arena-participant <%= 'arena-participant--dead' if current_hp <= 0 %> <%= 'arena-participant--npc' if is_npc %>"
     data-character-id="<%= participant_id %>"
     data-npc="<%= is_npc %>">
  <div class="arena-participant-avatar">
    <%= participation_avatar_tag(participation, size: :medium) %>
  </div>
  <div class="arena-participant-info">
    <span class="arena-participant-name"><%= participant_name %></span>
    <span class="arena-participant-level">[<%= participant_level %>]</span>

    <div class="arena-bars">
      <div class="arena-hp-bar">
        <div class="arena-hp-fill" style="width: <%= hp_percent %>%"></div>
        <span class="arena-hp-text"><%= current_hp %>/<%= max_hp %></span>
      </div>
      <% unless is_npc %>
        <div class="arena-mp-bar">
          <div class="arena-mp-fill" style="width: <%= mp_percent %>%"></div>
        </div>
      <% end %>
    </div>
  </div>

  <% if participation.result.present? && participation.result != "pending" %>
    <span class="arena-result-badge arena-result-badge--<%= participation.result %>">
      <%= participation.result.humanize %>
    </span>
  <% end %>
</div>
