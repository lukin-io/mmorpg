<div class="inventory-grid">
  <% items.each do |item| %>
    <div class="inventory-slot filled"
         data-item-id="<%= item.id %>"
         data-action="click->inventory#selectItem contextmenu->inventory#showContextMenu">
      <div class="item-icon item-rarity--<%= item.item_template.rarity %>">
        <%= item_slot_icon(item.item_template) %>
        <% if item.quantity > 1 %>
          <span class="item-quantity"><%= item.quantity %></span>
        <% end %>
        <% if item.enhancement_level.to_i > 0 %>
          <span class="item-enhancement">+<%= item.enhancement_level %></span>
        <% end %>
      </div>

      <div class="item-tooltip">
        <div class="tooltip-header">
          <strong class="item-name"><%= item.item_template.name %></strong>
          <% if item.enhancement_level.to_i > 0 %>
            <span class="enhancement-badge">+<%= item.enhancement_level %></span>
          <% end %>
        </div>
        <p class="item-rarity rarity--<%= item.item_template.rarity %>"><%= item.item_template.rarity.titleize %></p>
        <p class="item-type"><%= item.item_template.item_type.titleize %></p>

        <% if item.item_template.stat_modifiers.present? %>
          <div class="item-stats">
            <% item.item_template.stat_modifiers.each do |stat, value| %>
              <span class="stat-line">+<%= value %> <%= stat.titleize %></span>
            <% end %>
          </div>
        <% end %>

        <%# Description is not in current schema - skip for now %>

        <div class="item-actions-hint">
          <span>Left-click: Select</span>
          <span>Right-click: Options</span>
        </div>
      </div>
    </div>
  <% end %>

  <% (@inventory.max_slots - items.count).times do |i| %>
    <div class="inventory-slot empty" data-slot-index="<%= items.count + i %>">
      <span class="empty-slot-icon">+</span>
    </div>
  <% end %>
</div>

<div class="item-context-menu" data-inventory-target="contextMenu" style="display: none;">
  <ul>
    <li>
      <%= form_with url: equip_inventory_path, method: :post, data: {turbo_stream: true}, class: "context-menu-form" do %>
        <%= hidden_field_tag :item_id, "", data: {inventory_target: "contextItemId"} %>
        <button type="submit" class="context-menu-btn" data-action="click->inventory#hideContextMenu">Equip</button>
      <% end %>
    </li>
    <li>
      <%= form_with url: use_inventory_path, method: :post, data: {turbo_stream: true}, class: "context-menu-form" do %>
        <%= hidden_field_tag :item_id, "", data: {inventory_target: "contextItemId"} %>
        <button type="submit" class="context-menu-btn" data-action="click->inventory#hideContextMenu">Use</button>
      <% end %>
    </li>
    <li data-action="click->inventory#enhanceItem">Enhance</li>
    <li data-action="click->inventory#splitStack">Split Stack</li>
    <li class="danger" data-action="click->inventory#discardItem">Discard</li>
  </ul>
</div>
